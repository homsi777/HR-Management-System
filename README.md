# نظام إدارة الموارد البشرية (HR Management System)

نظام متكامل لإدارة الموارد البشرية، الموظفين، الرواتب، الحضور والانصراف، الإجازات، وأجهزة البصمة. تم بناء هذا النظام باستخدام Electron و React و Vite، مع دعم للتغليف لنظامي ويندوز وأندرويد.

## المتطلبات الأساسية

- [Node.js](https://nodejs.org/) (إصدار 18 أو أحدث)
- مدير الحزم [npm](https://www.npmjs.com/) (يأتي مع Node.js)
- لتغليف نسخة أندرويد، ستحتاج إلى [Android Studio](https://developer.android.com/studio).

## التثبيت

لتثبيت جميع الاعتماديات اللازمة للمشروع، قم بتشغيل الأمر التالي في الطرفية (Terminal):

```bash
npm install
```

## هيكلة المشروع (تحديث إعادة الهيكلة)

لتحسين قابلية الصيانة وتسهيل التطوير المستقبلي، تم إجراء إعادة هيكلة كبيرة للملفات الأساسية في المشروع (`main.js` و `database.js`). تم تقسيم المنطق البرمجي إلى وحدات أصغر وأكثر تركيزًا، وتم تنظيمها في مجلدات جديدة.

-   **`database_logic/`**: يحتوي هذا المجلد على كل المنطق المتعلق بقاعدة البيانات.
    -   `database.js` (الملف الرئيسي): يعمل الآن كمنظم ومهيئ لاتصال قاعدة البيانات.
    -   الوحدات مثل `auth.js`, `employee.js`, `attendance.js` وغيرها، تتعامل كل منها مع جزء معين من عمليات قاعدة البيانات.

-   **`main_services/`**: يحتوي على الخدمات التي تعمل في الخلفية مع عملية Electron الرئيسية.
    -   `apiServer.js`: يدير خادم HTTP المحلي لاستقبال البيانات.
    -   `smsService.js`: يعالج بوابة الرسائل وقائمة انتظار الرسائل.
    -   `scannerService.js`: يدير الاتصال بالماسح الضوئي للبطاقات الشخصية.

-   **`ipc_handlers/`**: ينظم جميع مستمعي `ipcMain` في العملية الرئيسية.
    -   `main.js` (الملف الرئيسي): يدير الآن بشكل أساسي دورة حياة التطبيق (مثل `createWindow`) ويهيئ الخدمات الأخرى.
    -   `index.js`: نقطة مركزية لتسجيل جميع معالجات IPC.
    -   الوحدات مثل `dbHandlers.js`, `appHandlers.js` وغيرها، تجمع قنوات IPC ذات الصلة معًا.

هذه البنية المعيارية تجعل الكود أكثر نظافة وسهولة في التصحيح والتوسيع.

## تكوين جهاز البصمة (مهم جدًا)

يعمل هذا البرنامج كنظام استقبال للبيانات (Server)، وهو لا يقوم بالاتصال المباشر لسحب البيانات من جهاز البصمة. بدلاً من ذلك، يجب عليك تكوين جهاز البصمة لكي يقوم هو بإرسال (Push) سجلات الحضور تلقائيًا إلى البرنامج.

1.  **خدمة الدفع (Push Service):**
    *   يعمل البرنامج على استقبال البيانات عبر منفذ TCP رقم `5005`.
    *   في إعدادات جهاز البصمة، اذهب إلى قسم **ADMS** أو **Push Service Settings**.
    *   قم بتعيين عنوان الخادم (Server IP) إلى عنوان الـ IP الخاص بالكمبيوتر الذي يعمل عليه هذا البرنامج.
    *   قم بتعيين منفذ الخادم (Server Port) إلى `5005`.

2.  **خدمة API (HTTP):**
    *   كبديل، يستمع البرنامج لطلبات HTTP على المنفذ `3001`.
    *   يمكن استخدام برامج وسيطة (Middleware) أو سكربتات لسحب البيانات من الجهاز وإعادة إرسالها بصيغة JSON إلى العنوان: `http://[IP_الكمبيوتر]:3001`.

**بمجرد إتمام هذه الإعدادات، ستظهر سجلات الحضور الجديدة في البرنامج تلقائيًا وفور تسجيلها على الجهاز.**

## 1. تشغيل نسخة سطح المكتب (ويندوز)

لتشغيل التطبيق في وضع التطوير مع التحديث التلقائي (Hot Reload)، استخدم الأمر التالي.

```bash
npm run electron-dev
```

عند التشغيل لأول مرة، سيتم إنشاء ملف قاعدة بيانات `database.db` مع حساب مسؤول افتراضي:
- **اسم المستخدم:** `admin`
- **كلمة المرور:** `admin`

### تغليف نسخة ويندوز

لإنشاء ملف تثبيت (installer) لبرنامج الويندوز، يمكنك تشغيل الأمر التالي:

```bash
npm run package
```

سيتم إنشاء الملفات النهائية في مجلد `release`.

---

## 2. تشغيل نسخة أندرويد

لتحضير وبناء نسخة الأندرويد، اتبع الخطوات التالية:

### الخطوة 1: بناء واجهة المستخدم

أولاً، قم ببناء النسخة النهائية من واجهة المستخدم (React) باستخدام الأمر التالي:

```bash
npm run android:build
```

### الخطوة 2: مزامنة المشروع مع أندرويد

بعد انتهاء البناء، قم بمزامنة الملفات الجديدة مع مشروع الأندرويد الأصلي. هذا الأمر يقوم أيضاً بإضافة منصة أندرويد إذا لم تكن موجودة.

```bash
npm run android:sync
```

### الخطوة 3: فتح المشروع في Android Studio

الآن، افتح مشروع الأندرويد في Android Studio لتتمكن من بناء وتجميع النسخة النهائية (APK).

```bash
npm run android:open
```

### الخطوة 4: البناء في Android Studio

بمجرد فتح المشروع في Android Studio:
1.  انتظر حتى تنتهي عملية `Gradle Sync`.
2.  من القائمة العلوية، اذهب إلى `Build > Build Bundle(s) / APK(s) > Build APK(s)`.
3.  بعد انتهاء البناء، ستجد ملف الـ `APK` جاهزاً للتثبيت في مجلد `capacitor-android/app/build/outputs/apk/debug/`.